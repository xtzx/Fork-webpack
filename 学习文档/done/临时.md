# æ·±åº¦é—®é¢˜è§£ç­” - Webpack æ¶æ„è®¾è®¡åŸç†

> è§£ç­”å…³äº webpack æ¶æ„è®¾è®¡çš„æ·±å±‚é—®é¢˜

---

## ğŸ“‹ ç›®å½•

1. [Webpack æ•´ä½“æ¶æ„æ ‘çŠ¶å›¾](#ä¸€webpack-æ•´ä½“æ¶æ„æ ‘çŠ¶å›¾)
2. [ä¸ºä»€ä¹ˆéœ€è¦ webpack-cliï¼Ÿ](#äºŒä¸ºä»€ä¹ˆéœ€è¦-webpack-cli)
3. [åŒ…ç®¡ç†å™¨è‡ªåŠ¨æ£€æµ‹åŸç†](#ä¸‰åŒ…ç®¡ç†å™¨è‡ªåŠ¨æ£€æµ‹åŸç†)
4. [webpack çš„ä»£ç ç”Ÿæˆæœºåˆ¶](#å››webpack-çš„ä»£ç ç”Ÿæˆæœºåˆ¶)
5. [å…­å¤§æ ¸å¿ƒé˜¶æ®µçš„æ¥æº](#äº”å…­å¤§æ ¸å¿ƒé˜¶æ®µçš„æ¥æº)

---

## ä¸€ã€Webpack æ•´ä½“æ¶æ„æ ‘çŠ¶å›¾

### 1.1 å®Œæ•´çš„æ–‡ä»¶æ ‘çŠ¶ç»“æ„ â­â­â­

```
webpack/
â”‚
â”œâ”€ğŸ“ bin/ ........................... å‘½ä»¤è¡Œå…¥å£ç›®å½•
â”‚  â””â”€ webpack.js ................... [æ ¸å¿ƒ] æ£€æµ‹å¹¶åŠ è½½ webpack-cliï¼Œæ”¯æŒå¤šåŒ…ç®¡ç†å™¨
â”‚
â”œâ”€ğŸ“ lib/ ........................... æ ¸å¿ƒæºç ç›®å½•ï¼ˆ540+ æ–‡ä»¶ï¼‰
â”‚  â”‚
â”‚  â”œâ”€ webpack.js ................... [æ ¸å¿ƒ] webpack() å·¥å‚å‡½æ•°ï¼Œåˆ›å»º Compilerï¼Œæ³¨å†Œæ’ä»¶
â”‚  â”œâ”€ index.js ..................... [å…¥å£] ä¸»å¯¼å‡ºæ–‡ä»¶ï¼Œå¯¼å‡ºæ‰€æœ‰å…¬å…± API
â”‚  â”‚
â”‚  â”œâ”€ Compiler.js .................. [æ ¸å¿ƒ] å…¨å±€ç¼–è¯‘å™¨ï¼Œç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œ30+ é’©å­
â”‚  â”œâ”€ Compilation.js ............... [æ ¸å¿ƒ] å•æ¬¡ç¼–è¯‘å®ä¾‹ï¼Œç®¡ç†æ¨¡å—/Chunk/èµ„æºï¼Œ50+ é’©å­
â”‚  â”‚
â”‚  â”œâ”€ NormalModuleFactory.js ....... [æ ¸å¿ƒ] æ¨¡å—å·¥å‚ï¼Œè§£æè·¯å¾„ï¼ŒåŒ¹é… loader è§„åˆ™
â”‚  â”œâ”€ NormalModule.js .............. [æ ¸å¿ƒ] æ™®é€šæ¨¡å—ï¼Œæ‰§è¡Œ loaderï¼Œè§£æ ASTï¼Œæ”¶é›†ä¾èµ–
â”‚  â”‚
â”‚  â”œâ”€ ModuleGraph.js ............... [æ ¸å¿ƒ] æ¨¡å—ä¾èµ–å›¾ï¼Œå­˜å‚¨æ¨¡å—å…³ç³»ï¼Œæ”¯æŒ Tree Shaking
â”‚  â”œâ”€ ChunkGraph.js ................ [æ ¸å¿ƒ] Chunk ä¾èµ–å›¾ï¼Œç®¡ç†æ¨¡å—åˆ° Chunk çš„åˆ†é…
â”‚  â”œâ”€ buildChunkGraph.js ........... [æ ¸å¿ƒ] æ„å»º Chunk å›¾ç®—æ³•ï¼ŒBFS éå†ï¼Œå¤„ç†ä»£ç åˆ†å‰²
â”‚  â”‚
â”‚  â”œâ”€ Chunk.js ..................... [æ•°æ®] Chunk ç±»ï¼Œè¡¨ç¤ºä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ï¼ˆbundleï¼‰
â”‚  â”œâ”€ ChunkGroup.js ................ [æ•°æ®] Chunk ç»„ï¼Œç®¡ç† Chunk çš„åŠ è½½å…³ç³»
â”‚  â”œâ”€ Entrypoint.js ................ [æ•°æ®] å…¥å£ç‚¹ï¼Œç‰¹æ®Šçš„ ChunkGroup
â”‚  â”‚
â”‚  â”œâ”€ Module.js .................... [åŸºç±»] æ¨¡å—æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰æ¨¡å—é€šç”¨æ¥å£
â”‚  â”œâ”€ Dependency.js ................ [åŸºç±»] ä¾èµ–æŠ½è±¡åŸºç±»ï¼Œè¡¨ç¤ºæ¨¡å—é—´çš„å¼•ç”¨å…³ç³»
â”‚  â”œâ”€ DependenciesBlock.js ......... [åŸºç±»] ä¾èµ–å—ï¼Œç®¡ç†åµŒå¥—ä¾èµ–ï¼ˆå¦‚ import()ï¼‰
â”‚  â”‚
â”‚  â”œâ”€ WebpackOptionsApply.js ....... [é…ç½®] åº”ç”¨å†…ç½®æ’ä»¶ï¼Œæ ¹æ®é…ç½®æ³¨å†ŒåŠŸèƒ½æ’ä»¶
â”‚  â”œâ”€ WebpackOptionsDefaulter.js ... [é…ç½®] åº”ç”¨é»˜è®¤é…ç½®å€¼ï¼ˆå·²åºŸå¼ƒï¼Œè¢« defaults.js æ›¿ä»£ï¼‰
â”‚  â”‚
â”‚  â”œâ”€ HotModuleReplacementPlugin.js  [æ’ä»¶] HMR æ ¸å¿ƒæ’ä»¶ï¼Œç”Ÿæˆ hot-update æ–‡ä»¶
â”‚  â”œâ”€ ProgressPlugin.js ............ [æ’ä»¶] è¿›åº¦æ˜¾ç¤ºæ’ä»¶ï¼Œè¾“å‡ºç¼–è¯‘è¿›åº¦
â”‚  â”œâ”€ DefinePlugin.js .............. [æ’ä»¶] å®šä¹‰å…¨å±€å¸¸é‡ï¼Œæ›¿æ¢ä»£ç ä¸­çš„å˜é‡
â”‚  â”‚
â”‚  â”œâ”€ Template.js .................. [å·¥å…·] ä»£ç æ¨¡æ¿å·¥å…·ï¼Œç”Ÿæˆè¿è¡Œæ—¶ä»£ç 
â”‚  â”œâ”€ RuntimeGlobals.js ............ [å¸¸é‡] è¿è¡Œæ—¶å…¨å±€å˜é‡åï¼ˆ__webpack_require__ ç­‰ï¼‰
â”‚  â”œâ”€ RuntimeModule.js ............. [åŸºç±»] è¿è¡Œæ—¶æ¨¡å—åŸºç±»ï¼Œç”Ÿæˆè¿è¡Œæ—¶ä»£ç ç‰‡æ®µ
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ javascript/ ................. JavaScript æ¨¡å—å¤„ç†ç›®å½•
â”‚  â”‚  â”œâ”€ JavascriptParser.js ....... [æ ¸å¿ƒ] JS è§£æå™¨ï¼Œä½¿ç”¨ acorn è§£æ ASTï¼Œè¯†åˆ«ä¾èµ–
â”‚  â”‚  â”œâ”€ JavascriptGenerator.js .... [æ ¸å¿ƒ] JS ä»£ç ç”Ÿæˆå™¨ï¼Œç”Ÿæˆæœ€ç»ˆä»£ç 
â”‚  â”‚  â”œâ”€ JavascriptModulesPlugin.js  [æ ¸å¿ƒ] JS æ¨¡å—æ’ä»¶ï¼Œæ¸²æŸ“ bundle ç»“æ„ï¼ŒIIFE åŒ…è£…
â”‚  â”‚  â””â”€ ... ...................... ï¼ˆ10+ æ–‡ä»¶ï¼‰
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ dependencies/ ............... ä¾èµ–ç±»å‹ç›®å½•ï¼ˆ115+ æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ HarmonyImportDependency.js  [ç±»å‹] ESM import ä¾èµ–
â”‚  â”‚  â”œâ”€ CommonJsRequireDependency.js [ç±»å‹] CommonJS require ä¾èµ–
â”‚  â”‚  â”œâ”€ ImportDependency.js ........ [ç±»å‹] åŠ¨æ€ import() ä¾èµ–
â”‚  â”‚  â”œâ”€ ModuleHotAcceptDependency.js [ç±»å‹] HMR accept ä¾èµ–
â”‚  â”‚  â””â”€ ... ...................... ï¼ˆ100+ ç§ä¾èµ–ç±»å‹ï¼‰
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ optimize/ ................... ä¼˜åŒ–æ’ä»¶ç›®å½•ï¼ˆ19 æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ SplitChunksPlugin.js ...... [æ’ä»¶] ä»£ç åˆ†å‰²ï¼Œæå–å…¬å…±æ¨¡å—
â”‚  â”‚  â”œâ”€ ModuleConcatenationPlugin.js [æ’ä»¶] Scope Hoistingï¼Œåˆå¹¶æ¨¡å—
â”‚  â”‚  â”œâ”€ FlagDependencyUsagePlugin.js [æ’ä»¶] æ ‡è®°ä¾èµ–ä½¿ç”¨æƒ…å†µï¼ˆTree Shakingï¼‰
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ cache/ ...................... ç¼“å­˜ç³»ç»Ÿç›®å½•ï¼ˆ9 æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ Cache.js .................. [æ ¸å¿ƒ] ç¼“å­˜ç®¡ç†å™¨ï¼Œæ”¯æŒå†…å­˜å’Œæ–‡ä»¶ç³»ç»Ÿç¼“å­˜
â”‚  â”‚  â”œâ”€ MemoryCachePlugin.js ...... [æ’ä»¶] å†…å­˜ç¼“å­˜æ’ä»¶
â”‚  â”‚  â”œâ”€ IdleFileCachePlugin.js .... [æ’ä»¶] æ–‡ä»¶ç¼“å­˜æ’ä»¶ï¼ŒæŒä¹…åŒ–åˆ°ç£ç›˜
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ hmr/ ........................ HMR ç›¸å…³ç›®å½•ï¼ˆ5 æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ HotModuleReplacementRuntimeModule.js [è¿è¡Œæ—¶] ç”Ÿæˆ HMR è¿è¡Œæ—¶ä»£ç 
â”‚  â”‚  â”œâ”€ HotModuleReplacement.runtime.js [è¿è¡Œæ—¶] module.hot API å®ç°
â”‚  â”‚  â”œâ”€ JavascriptHotModuleReplacement.runtime.js JSONP çƒ­æ›´æ–°å®ç°
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ runtime/ .................... è¿è¡Œæ—¶æ¨¡å—ç›®å½•ï¼ˆ29 æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ LoadScriptRuntimeModule.js  [è¿è¡Œæ—¶] åŠ¨æ€åŠ è½½ script æ ‡ç­¾
â”‚  â”‚  â”œâ”€ EnsureChunkRuntimeModule.js [è¿è¡Œæ—¶] __webpack_require__.e å®ç°
â”‚  â”‚  â”œâ”€ GetChunkFilenameRuntimeModule.js è·å– chunk æ–‡ä»¶å
â”‚  â”‚  â””â”€ ... ...................... ï¼ˆ25+ è¿è¡Œæ—¶åŠŸèƒ½ï¼‰
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ node/ ....................... Node.js ç¯å¢ƒæ”¯æŒï¼ˆ11 æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ NodeEnvironmentPlugin.js .. [æ’ä»¶] æ³¨å…¥ Node.js æ–‡ä»¶ç³»ç»Ÿ
â”‚  â”‚  â”œâ”€ NodeTargetPlugin.js ....... [æ’ä»¶] Node.js ç›®æ ‡ç¯å¢ƒé…ç½®
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ web/ ........................ Web ç¯å¢ƒæ”¯æŒï¼ˆ5 æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ JsonpChunkLoadingRuntimeModule.js JSONP åŠ è½½ chunk
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ wasm/ ....................... WebAssembly æ”¯æŒ
â”‚  â”œâ”€ğŸ“ wasm-async/ ................. å¼‚æ­¥ WASM æ”¯æŒ
â”‚  â”œâ”€ğŸ“ wasm-sync/ .................. åŒæ­¥ WASM æ”¯æŒ
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ container/ .................. æ¨¡å—è”é‚¦ï¼ˆModule Federationï¼‰
â”‚  â”œâ”€ğŸ“ sharing/ .................... æ¨¡å—å…±äº«
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ asset/ ...................... èµ„æºæ¨¡å—ï¼ˆAsset Modulesï¼‰
â”‚  â”œâ”€ğŸ“ json/ ....................... JSON æ¨¡å—æ”¯æŒ
â”‚  â”œâ”€ğŸ“ css/ ........................ CSS æ¨¡å—æ”¯æŒï¼ˆå®éªŒæ€§ï¼‰
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ ids/ ........................ ID ç”Ÿæˆç­–ç•¥ï¼ˆ12 æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ HashedModuleIdsPlugin.js .. [æ’ä»¶] åŸºäºå†…å®¹ hash çš„æ¨¡å— ID
â”‚  â”‚  â”œâ”€ DeterministicChunkIdsPlugin.js ç¡®å®šæ€§ chunk ID
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ library/ .................... åº“æ¨¡å¼æ”¯æŒï¼ˆ9 æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ UmdLibraryPlugin.js ....... [æ’ä»¶] UMD æ ¼å¼åº“
â”‚  â”‚  â”œâ”€ CommonJsLibraryPlugin.js .. [æ’ä»¶] CommonJS æ ¼å¼åº“
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ config/ ..................... é…ç½®å¤„ç†ï¼ˆ4 æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ defaults.js ............... [æ ¸å¿ƒ] é»˜è®¤é…ç½®é€»è¾‘ï¼Œ1800+ è¡Œ
â”‚  â”‚  â”œâ”€ normalization.js .......... [æ ¸å¿ƒ] é…ç½®è§„èŒƒåŒ–
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ util/ ....................... å·¥å…·å‡½æ•°ç›®å½•ï¼ˆ47+ æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ fs.js ..................... [å·¥å…·] æ–‡ä»¶ç³»ç»Ÿå·¥å…·
â”‚  â”‚  â”œâ”€ hash/ ..................... å“ˆå¸Œç®—æ³•ï¼ˆmd4ã€xxhash64ï¼‰
â”‚  â”‚  â”œâ”€ comparators.js ............ [å·¥å…·] æ’åºæ¯”è¾ƒå‡½æ•°
â”‚  â”‚  â”œâ”€ createHash.js ............. [å·¥å…·] åˆ›å»ºå“ˆå¸Œå¯¹è±¡
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ serialization/ .............. åºåˆ—åŒ–ç³»ç»Ÿï¼ˆ15 æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ ObjectMiddleware.js ....... [æ ¸å¿ƒ] å¯¹è±¡åºåˆ—åŒ–ï¼Œæ”¯æŒæŒä¹…åŒ–ç¼“å­˜
â”‚  â”‚  â”œâ”€ Serializer.js ............. [æ ¸å¿ƒ] åºåˆ—åŒ–å™¨ä¸»ç±»
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ stats/ ...................... ç»Ÿè®¡ä¿¡æ¯ï¼ˆ5 æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ StatsFactory.js ........... [æ ¸å¿ƒ] ç»Ÿè®¡ä¿¡æ¯å·¥å‚
â”‚  â”‚  â”œâ”€ StatsPrinter.js ........... [æ ¸å¿ƒ] ç»Ÿè®¡ä¿¡æ¯æ‰“å°å™¨
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ğŸ“ logging/ .................... æ—¥å¿—ç³»ç»Ÿï¼ˆ4 æ–‡ä»¶ï¼‰
â”‚  â”‚  â”œâ”€ Logger.js ................. [æ ¸å¿ƒ] æ—¥å¿—è®°å½•å™¨
â”‚  â”‚  â””â”€ ...
â”‚  â”‚
â”‚  â”œâ”€ FileSystemInfo.js ............ [å·¥å…·] æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ç®¡ç†ï¼Œå¤„ç†æ—¶é—´æˆ³å’Œä¾èµ–
â”‚  â”œâ”€ RequestShortener.js .......... [å·¥å…·] è·¯å¾„ç¼©çŸ­ï¼Œä¼˜åŒ–æ—¥å¿—è¾“å‡º
â”‚  â”œâ”€ Stats.js ..................... [æ•°æ®] ç¼–è¯‘ç»Ÿè®¡ä¿¡æ¯å°è£…
â”‚  â”œâ”€ Watching.js .................. [åŠŸèƒ½] Watch æ¨¡å¼ç®¡ç†ï¼Œç›‘å¬æ–‡ä»¶å˜åŒ–
â”‚  â”‚
â”‚  â””â”€ ... .......................... ï¼ˆè¿˜æœ‰ 100+ æ ¸å¿ƒæ–‡ä»¶ï¼‰
â”‚
â”œâ”€ğŸ“ hot/ ........................... HMR å®¢æˆ·ç«¯è¿è¡Œæ—¶
â”‚  â”œâ”€ dev-server.js ................ [æ ¸å¿ƒ] WebSocket å®¢æˆ·ç«¯ï¼Œæ¥æ”¶æ›´æ–°é€šçŸ¥
â”‚  â”œâ”€ emitter.js ................... [å·¥å…·] äº‹ä»¶å‘å°„å™¨ï¼Œç”¨äºæ¨¡å—é—´é€šä¿¡
â”‚  â”œâ”€ poll.js ...................... [æ¨¡å¼] è½®è¯¢æ¨¡å¼ HMRï¼ˆNode.jsï¼‰
â”‚  â”œâ”€ signal.js .................... [æ¨¡å¼] ä¿¡å·æ¨¡å¼ HMRï¼ˆNode.jsï¼‰
â”‚  â””â”€ log.js ....................... [å·¥å…·] HMR æ—¥å¿—å·¥å…·
â”‚
â”œâ”€ğŸ“ schemas/ ....................... JSON Schema éªŒè¯
â”‚  â”œâ”€ WebpackOptions.json .......... [Schema] webpack é…ç½®çš„å®Œæ•´ Schema
â”‚  â””â”€ plugins/ ..................... å„æ’ä»¶é…ç½®çš„ Schema
â”‚
â”œâ”€ğŸ“ declarations/ .................. TypeScript ç±»å‹å£°æ˜
â”‚  â”œâ”€ index.d.ts ................... [ç±»å‹] ä¸»ç±»å‹æ–‡ä»¶
â”‚  â”œâ”€ WebpackOptions.d.ts .......... [ç±»å‹] é…ç½®å¯¹è±¡ç±»å‹
â”‚  â””â”€ LoaderContext.d.ts ........... [ç±»å‹] loader ä¸Šä¸‹æ–‡ç±»å‹
â”‚
â”œâ”€ğŸ“ tooling/ ....................... å·¥å…·è„šæœ¬ç›®å½•
â”‚  â”œâ”€ generate-runtime-code.js ..... [å·¥å…·] ç”Ÿæˆä¼˜åŒ–çš„è¿è¡Œæ—¶ä»£ç ï¼ˆå‹ç¼©ã€ES5 è½¬æ¢ï¼‰
â”‚  â”œâ”€ generate-wasm-code.js ........ [å·¥å…·] ç”Ÿæˆ WASM ç›¸å…³ä»£ç 
â”‚  â””â”€ decode-debug-hash.js ......... [å·¥å…·] è°ƒè¯•å“ˆå¸Œå€¼
â”‚
â”œâ”€ğŸ“ examples/ ...................... ç¤ºä¾‹é¡¹ç›®ç›®å½•ï¼ˆ50+ ç¤ºä¾‹ï¼‰
â”‚  â”œâ”€ code-splitting/ .............. ä»£ç åˆ†å‰²ç¤ºä¾‹
â”‚  â”œâ”€ module-federation/ ........... æ¨¡å—è”é‚¦ç¤ºä¾‹
â”‚  â””â”€ ... .......................... ï¼ˆæ¼”ç¤ºå„ç§åŠŸèƒ½ï¼‰
â”‚
â”œâ”€ğŸ“ test/ .......................... æµ‹è¯•ç›®å½•ï¼ˆ5800+ æµ‹è¯•æ–‡ä»¶ï¼‰
â”‚  â”œâ”€ cases/ ....................... åŸºç¡€æµ‹è¯•ç”¨ä¾‹
â”‚  â”œâ”€ configCases/ ................. é…ç½®ç›¸å…³æµ‹è¯•
â”‚  â”œâ”€ statsCases/ .................. ç»Ÿè®¡ä¿¡æ¯æµ‹è¯•
â”‚  â””â”€ hotCases/ .................... HMR æµ‹è¯•
â”‚
â”œâ”€ğŸ“ benchmark/ ..................... æ€§èƒ½åŸºå‡†æµ‹è¯•
â”‚  â””â”€ benchmark.js ................. æ€§èƒ½æµ‹è¯•è„šæœ¬
â”‚
â”œâ”€ğŸ“ assembly/ ...................... AssemblyScript å®ç°çš„å“ˆå¸Œç®—æ³•
â”‚  â””â”€ hash/ ........................ é«˜æ€§èƒ½å“ˆå¸Œï¼ˆmd4ã€xxhash64ï¼‰
â”‚
â”œâ”€ package.json .................... [é…ç½®] npm åŒ…é…ç½®ï¼Œä¾èµ–ç®¡ç†
â”œâ”€ tsconfig.json ................... [é…ç½®] TypeScript é…ç½®
â”œâ”€ README.md ....................... é¡¹ç›®è¯´æ˜æ–‡æ¡£
â””â”€ LICENSE ......................... MIT è®¸å¯è¯
```

### 1.2 lib/ ç›®å½•æ ¸å¿ƒæ–‡ä»¶è¯¦ç»†æ ‡æ³¨

```
lib/
â”‚
â”œâ”€â”€â”€ ã€å…¥å£ä¸æ§åˆ¶å±‚ã€‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”œâ”€ webpack.js ...................... [å…¥å£] åˆ›å»º Compilerï¼Œ9 æ­¥åˆå§‹åŒ–æµç¨‹ï¼Œæ’ä»¶æ³¨å†Œä¸­å¿ƒ
â”œâ”€ Compiler.js ..................... [æ§åˆ¶] å…¨å±€ç¼–è¯‘å™¨ï¼Œç®¡ç†æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ–‡ä»¶ç³»ç»Ÿï¼Œç¼“å­˜
â”œâ”€ Compilation.js .................. [æ§åˆ¶] å•æ¬¡ç¼–è¯‘ç®¡ç†ï¼Œæ¨¡å—æ„å»ºï¼ŒChunk ç”Ÿæˆï¼Œèµ„æºè¾“å‡º
â”‚
â”œâ”€â”€â”€ ã€æ¨¡å—æ„å»ºå±‚ã€‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”œâ”€ NormalModuleFactory.js .......... [å·¥å‚] åˆ›å»ºæ™®é€šæ¨¡å—ï¼Œè·¯å¾„è§£æï¼Œloader åŒ¹é…æ ¸å¿ƒ
â”œâ”€ ContextModuleFactory.js ......... [å·¥å‚] åˆ›å»ºä¸Šä¸‹æ–‡æ¨¡å—ï¼ˆrequire.contextï¼‰
â”œâ”€ NormalModule.js ................. [æ¨¡å—] æœ€å¸¸ç”¨æ¨¡å—ç±»å‹ï¼Œæ‰§è¡Œ loaderï¼Œè§£æ AST ä¾èµ–
â”œâ”€ ContextModule.js ................ [æ¨¡å—] ä¸Šä¸‹æ–‡æ¨¡å—ï¼ŒåŠ¨æ€ require æ”¯æŒ
â”œâ”€ ExternalModule.js ............... [æ¨¡å—] å¤–éƒ¨æ¨¡å—ï¼Œè¿è¡Œæ—¶å¼•ç”¨ï¼ˆä¸æ‰“åŒ…ï¼‰
â”œâ”€ RawModule.js .................... [æ¨¡å—] åŸå§‹æ¨¡å—ï¼Œç›´æ¥æä¾›æºç ï¼ˆæ— éœ€æ„å»ºï¼‰
â”œâ”€ DelegatedModule.js .............. [æ¨¡å—] å§”æ‰˜æ¨¡å—ï¼ˆDLL æ’ä»¶ä½¿ç”¨ï¼‰
â”‚
â”œâ”€â”€â”€ ã€ä¾èµ–å›¾å±‚ã€‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”œâ”€ ModuleGraph.js .................. [æ ¸å¿ƒ] æ¨¡å—ä¾èµ–å›¾ï¼Œå­˜å‚¨èŠ‚ç‚¹å’Œè¾¹ï¼ŒO(1) æŸ¥è¯¢
â”œâ”€ ModuleGraphConnection.js ........ [æ•°æ®] ä¾èµ–è¿æ¥ï¼Œè¡¨ç¤ºæ¨¡å—é—´çš„å¼•ç”¨å…³ç³»
â”œâ”€ ModuleGraphModule.js ............ [æ•°æ®] æ¨¡å—å›¾èŠ‚ç‚¹ï¼Œå­˜å‚¨æ¨¡å—çš„å›¾ä¿¡æ¯
â”œâ”€ ChunkGraph.js ................... [æ ¸å¿ƒ] Chunk ä¾èµ–å›¾ï¼Œç®¡ç†æ¨¡å—-Chunk æ˜ å°„
â”œâ”€ buildChunkGraph.js .............. [ç®—æ³•] BFS æ„å»º Chunk å›¾ï¼Œå¤„ç†ä»£ç åˆ†å‰²
â”‚
â”œâ”€â”€â”€ ã€Chunk å±‚ã€‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”œâ”€ Chunk.js ........................ [æ•°æ®] Chunk ç±»ï¼Œè¡¨ç¤ºè¾“å‡ºæ–‡ä»¶ï¼Œç®¡ç†æ–‡ä»¶åå’Œ hash
â”œâ”€ ChunkGroup.js ................... [æ•°æ®] Chunk ç»„ï¼Œç®¡ç†åŠ è½½é¡ºåºå’Œçˆ¶å­å…³ç³»
â”œâ”€ Entrypoint.js ................... [æ•°æ®] å…¥å£ç‚¹ï¼Œç‰¹æ®Šçš„ ChunkGroupï¼Œå…³è”å…¥å£é…ç½®
â”œâ”€ HotUpdateChunk.js ............... [æ•°æ®] çƒ­æ›´æ–° Chunkï¼ŒHMR ä¸“ç”¨
â”œâ”€ ChunkTemplate.js ................ [æ¨¡æ¿] Chunk æ¨¡æ¿ï¼ˆå·²åºŸå¼ƒï¼‰
â”‚
â”œâ”€â”€â”€ ã€è§£æå±‚ã€‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”œâ”€ Parser.js ....................... [åŸºç±»] è§£æå™¨æŠ½è±¡åŸºç±»
â”œâ”€ Generator.js .................... [åŸºç±»] ä»£ç ç”Ÿæˆå™¨æŠ½è±¡åŸºç±»
â”œâ”€ ResolverFactory.js .............. [å·¥å‚] åˆ›å»ºè·¯å¾„è§£æå™¨ï¼ŒåŸºäº enhanced-resolve
â”œâ”€ RuleSet.js ...................... [æ ¸å¿ƒ] è§„åˆ™åŒ¹é…ç³»ç»Ÿï¼Œå¤„ç† module.rules é…ç½®
â”‚
â”œâ”€â”€â”€ ã€è¿è¡Œæ—¶å±‚ã€‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”œâ”€ RuntimeGlobals.js ............... [å¸¸é‡] å®šä¹‰æ‰€æœ‰è¿è¡Œæ—¶å…¨å±€å˜é‡å
â”œâ”€ RuntimeModule.js ................ [åŸºç±»] è¿è¡Œæ—¶æ¨¡å—åŸºç±»ï¼Œå„ç§ __webpack_require__.* å®ç°
â”œâ”€ Template.js ..................... [å·¥å…·] ä»£ç æ¨¡æ¿å·¥å…·ï¼Œæ‹¼æ¥ä»£ç å­—ç¬¦ä¸²
â”œâ”€ JavascriptMetaInfoPlugin.js ..... [æ’ä»¶] æ³¨å…¥ __dirnameã€__filename ç­‰
â”‚
â”œâ”€â”€â”€ ã€ä¼˜åŒ–å±‚ã€‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”œâ”€ FlagDependencyExportsPlugin.js .. [æ’ä»¶] åˆ†æå¯¼å‡ºä¿¡æ¯ï¼Œæ”¯æŒ Tree Shaking
â”œâ”€ FlagDependencyUsagePlugin.js .... [æ’ä»¶] æ ‡è®°å“ªäº›å¯¼å‡ºè¢«ä½¿ç”¨
â”œâ”€ SideEffectsFlagPlugin.js ........ [æ’ä»¶] å¤„ç† sideEffects é…ç½®
â”œâ”€ MangleExportsPlugin.js .......... [æ’ä»¶] å‹ç¼©å¯¼å‡ºåç§°
â”‚
â”œâ”€â”€â”€ ã€è¾“å‡ºå±‚ã€‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”œâ”€ FileSystemInfo.js ............... [æ ¸å¿ƒ] æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ï¼Œç®¡ç†æ—¶é—´æˆ³ï¼Œæ£€æµ‹æ–‡ä»¶å˜åŒ–
â”œâ”€ Stats.js ........................ [æ•°æ®] ç¼–è¯‘ç»Ÿè®¡ä¿¡æ¯ï¼Œæ ¼å¼åŒ–è¾“å‡º
â”œâ”€ MainTemplate.js ................. [æ¨¡æ¿] ä¸»æ¨¡æ¿ï¼ˆå·²åºŸå¼ƒï¼Œè¢« JavascriptModulesPlugin æ›¿ä»£ï¼‰
â”œâ”€ ChunkTemplate.js ................ [æ¨¡æ¿] Chunk æ¨¡æ¿ï¼ˆå·²åºŸå¼ƒï¼‰
â”‚
â”œâ”€â”€â”€ ã€é”™è¯¯å¤„ç†å±‚ã€‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”œâ”€ WebpackError.js ................. [åŸºç±»] webpack é”™è¯¯åŸºç±»
â”œâ”€ ModuleBuildError.js ............. [é”™è¯¯] æ¨¡å—æ„å»ºé”™è¯¯
â”œâ”€ ModuleNotFoundError.js .......... [é”™è¯¯] æ¨¡å—æœªæ‰¾åˆ°é”™è¯¯
â”œâ”€ ModuleParseError.js ............. [é”™è¯¯] æ¨¡å—è§£æé”™è¯¯
â”‚
â”œâ”€â”€â”€ ã€ç¼“å­˜ä¸åºåˆ—åŒ–ã€‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”œâ”€ Cache.js ........................ [æ ¸å¿ƒ] ç¼“å­˜é—¨é¢ï¼Œç»Ÿä¸€ç¼“å­˜æ¥å£
â”œâ”€ CacheFacade.js .................. [æ ¸å¿ƒ] ç¼“å­˜å¤–è§‚æ¨¡å¼å®ç°
â”œâ”€ FileSystemInfo.js ............... [æ ¸å¿ƒ] æ–‡ä»¶ç³»ç»Ÿå¿«ç…§ï¼Œæ”¯æŒå¢é‡æ„å»º
â”‚
â””â”€â”€â”€ ã€é…ç½®ä¸åº”ç”¨ã€‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”œâ”€ WebpackOptionsApply.js ...... [æ ¸å¿ƒ] åº”ç”¨å†…ç½®æ’ä»¶ï¼Œ700+ è¡Œé…ç½®é€»è¾‘
    â”œâ”€ WebpackOptionsValidationError.js é…ç½®éªŒè¯é”™è¯¯
    â””â”€ validateSchema.js ........... [å·¥å…·] JSON Schema éªŒè¯å·¥å…·
```

### 1.3 æ¨¡å—ç±»å‹åˆ†å±‚

```mermaid
graph TD
    Module[Module åŸºç±»] --> NormalModule[NormalModule<br/>æœ€å¸¸ç”¨ï¼Œé€šè¿‡ loader å¤„ç†]
    Module --> ContextModule[ContextModule<br/>require.context]
    Module --> ExternalModule[ExternalModule<br/>å¤–éƒ¨å¼•ç”¨ä¸æ‰“åŒ…]
    Module --> RawModule[RawModule<br/>ç›´æ¥æä¾›æºç ]
    Module --> DelegatedModule[DelegatedModule<br/>DLL å§”æ‰˜]
    Module --> RuntimeModule[RuntimeModule<br/>è¿è¡Œæ—¶ä»£ç ]

    RuntimeModule --> HMRRuntime[HotModuleReplacementRuntimeModule]
    RuntimeModule --> LoadScriptRuntime[LoadScriptRuntimeModule]
    RuntimeModule --> EnsureChunkRuntime[EnsureChunkRuntimeModule]

    style NormalModule fill:#ff9999
    style RuntimeModule fill:#99ccff
```

---

## äºŒã€ä¸ºä»€ä¹ˆéœ€è¦ webpack-cliï¼Ÿ

### 2.1 webpack ä¸ webpack-cli çš„åˆ†ç¦»è®¾è®¡ â­â­â­

```mermaid
graph TD
    User[ç”¨æˆ·æ‰§è¡Œ webpack å‘½ä»¤] --> Bin[bin/webpack.js]

    Bin --> CheckCLI{webpack-cli<br/>å·²å®‰è£…?}

    CheckCLI -->|å¦| DetectPM[æ£€æµ‹åŒ…ç®¡ç†å™¨<br/>yarn.lock â†’ yarn<br/>pnpm-lock.yaml â†’ pnpm<br/>é»˜è®¤ â†’ npm]

    DetectPM --> AskUser{è¯¢é—®ç”¨æˆ·<br/>æ˜¯å¦å®‰è£…?}

    AskUser -->|å¦| Exit[é€€å‡º exitCode=1]
    AskUser -->|æ˜¯| Install[è‡ªåŠ¨å®‰è£…<br/>npm install -D webpack-cli]

    Install --> RunCLI
    CheckCLI -->|æ˜¯| RunCLI[è¿è¡Œ webpack-cli]

    RunCLI --> CheckType{package.json<br/>type="module"?}

    CheckType -->|æ˜¯| ImportESM[import webpack-cli<br/>ESM æ¨¡å—]
    CheckType -->|å¦| RequireCJS[require webpack-cli<br/>CommonJS æ¨¡å—]

    ImportESM --> CLI[webpack-cli å¯åŠ¨]
    RequireCJS --> CLI

    CLI --> ParseArgs[è§£æå‘½ä»¤è¡Œå‚æ•°<br/>--config --mode --entry...]
    CLI --> LoadConfig[åŠ è½½é…ç½®æ–‡ä»¶<br/>webpack.config.js]
    CLI --> CallWebpack[è°ƒç”¨ webpack API<br/>webpack config]
    CLI --> OutputStats[è¾“å‡ºç»Ÿè®¡ä¿¡æ¯<br/>å½©è‰²æ—¥å¿—ã€è¿›åº¦æ¡]

    style Bin fill:#ff9999
    style RunCLI fill:#99ccff
    style CLI fill:#99ff99
```

### 2.2 ä¸ºä»€ä¹ˆè¦åˆ†ç¦»ï¼Ÿâ­â­â­

#### åŸå›  1: èŒè´£åˆ†ç¦»ï¼ˆå•ä¸€èŒè´£åŸåˆ™ï¼‰

```javascript
/**
 * webpack æ ¸å¿ƒ = çº¯ç¼–è¯‘å¼•æ“
 *
 * ã€åªåšã€‘
 * - æ¨¡å—è§£æ
 * - loader è½¬æ¢
 * - ä¾èµ–åˆ†æ
 * - ä»£ç ç”Ÿæˆ
 * - æ–‡ä»¶è¾“å‡º
 *
 * ã€ä¸åšã€‘
 * - å‘½ä»¤è¡Œå‚æ•°è§£æ âŒ
 * - é…ç½®æ–‡ä»¶åŠ è½½ âŒ
 * - å½©è‰²æ—¥å¿—è¾“å‡º âŒ
 * - äº¤äº’å¼ç•Œé¢ âŒ
 */

/**
 * webpack-cli = å‘½ä»¤è¡Œç•Œé¢
 *
 * ã€åªåšã€‘
 * - å‘½ä»¤è¡Œå‚æ•°è§£æï¼ˆ--configã€--modeï¼‰
 * - é…ç½®æ–‡ä»¶åŠ è½½ï¼ˆwebpack.config.jsï¼‰
 * - å½©è‰²æ—¥å¿—å’Œè¿›åº¦æ¡
 * - è„šæ‰‹æ¶åŠŸèƒ½ï¼ˆwebpack initï¼‰
 *
 * ã€ä¸åšã€‘
 * - æ¨¡å—ç¼–è¯‘é€»è¾‘ âŒ
 * - ä¾èµ–è§£æ âŒ
 * - ä»£ç ç”Ÿæˆ âŒ
 */

// å¥½å¤„ï¼š
// 1. webpack æ ¸å¿ƒä¿æŒç®€æ´ï¼ˆåªå…³æ³¨ç¼–è¯‘ï¼‰
// 2. CLI å¯ä»¥ç‹¬ç«‹æ›´æ–°ï¼ˆä¸å½±å“æ ¸å¿ƒï¼‰
// 3. å¯ä»¥æœ‰å¤šä¸ª CLI å®ç°
```

#### åŸå›  2: API ä½¿ç”¨åœºæ™¯ â­â­

```javascript
/**
 * åœºæ™¯1: å‘½ä»¤è¡Œä½¿ç”¨ï¼ˆéœ€è¦ CLIï¼‰
 */
// ç»ˆç«¯æ‰§è¡Œ
$ webpack --mode production --entry ./src/index.js

// bin/webpack.js â†’ æ£€æµ‹ webpack-cli â†’ è¿è¡Œ CLI
// CLI è§£æå‚æ•°ï¼Œè°ƒç”¨ webpack() API

/**
 * åœºæ™¯2: Node.js API ä½¿ç”¨ï¼ˆä¸éœ€è¦ CLIï¼‰â­
 */
// build.js
const webpack = require('webpack');
const config = require('./webpack.config.js');

// ç›´æ¥è°ƒç”¨ APIï¼Œæ— éœ€ CLI
webpack(config, (err, stats) => {
  if (err) {
    console.error(err);
    return;
  }

  console.log(stats.toString({
    colors: true
  }));
});

// åœºæ™¯3: webpack-dev-server ä½¿ç”¨ï¼ˆä¸éœ€è¦ CLIï¼‰
const webpack = require('webpack');
const WebpackDevServer = require('webpack-dev-server');

const compiler = webpack(config);
const server = new WebpackDevServer(compiler, options);

server.listen(8080);

/**
 * æ€»ç»“ï¼š
 * - å‘½ä»¤è¡Œä½¿ç”¨ â†’ éœ€è¦ CLI
 * - API ä½¿ç”¨ â†’ ä¸éœ€è¦ CLI
 * - åˆ†ç¦»è®¾è®¡è®©ä¸¤ç§åœºæ™¯éƒ½èƒ½æ­£å¸¸å·¥ä½œ
 */
```

#### åŸå›  3: çµæ´»æ€§ â­

```javascript
/**
 * å¯ä»¥æœ‰å¤šä¸ª CLI å®ç°
 */

// å®˜æ–¹ CLI
npm install webpack-cli

// ç¤¾åŒº CLIï¼ˆæ›¾ç»å­˜åœ¨ï¼‰
npm install webpack-command  // å·²åºŸå¼ƒ

// è‡ªå®šä¹‰ CLI
// åªè¦å®ç°å‚æ•°è§£æï¼Œè°ƒç”¨ webpack() API å³å¯

/**
 * bin/webpack.js çš„è®¾è®¡å…è®¸è¿™ç§çµæ´»æ€§
 * åªæ£€æŸ¥ webpack-cliï¼Œä½†ä¸ç¡¬ç¼–ç 
 */
```

### 2.3 webpack-cli æ˜¯å¿…é¡»çš„å—ï¼Ÿâ­â­

**ç­”æ¡ˆï¼šä¸æ˜¯å¿…é¡»çš„ï¼**

```javascript
// ===== åœºæ™¯1: ä½¿ç”¨å‘½ä»¤è¡Œ =====
// å¿…é¡»å®‰è£… webpack-cli
$ webpack --mode production
// âœ… éœ€è¦ CLI è§£æå‘½ä»¤è¡Œå‚æ•°

// ===== åœºæ™¯2: ä½¿ç”¨ Node.js API =====
// ä¸éœ€è¦ webpack-cli
const webpack = require('webpack');
webpack({ /* config */ }, callback);
// âœ… ç›´æ¥è°ƒç”¨ APIï¼Œæ— éœ€ CLI

// ===== åœºæ™¯3: ä½¿ç”¨ webpack-dev-server =====
// ä¸éœ€è¦ webpack-cli
const webpack = require('webpack');
const WebpackDevServer = require('webpack-dev-server');
const compiler = webpack(config);
const server = new WebpackDevServer(compiler);
// âœ… dev-server å†…éƒ¨è°ƒç”¨ webpack API

// ===== åœºæ™¯4: è‡ªå®šä¹‰æ„å»ºè„šæœ¬ =====
// ä¸éœ€è¦ webpack-cli
// scripts/build.js
const webpack = require('webpack');
const config = {
  entry: './src/index.js',
  output: { path: './dist', filename: 'bundle.js' }
};

webpack(config).run((err, stats) => {
  console.log('æ„å»ºå®Œæˆ');
});

// package.json
{
  "scripts": {
    "build": "node scripts/build.js"  // âœ… ä¸ä½¿ç”¨ CLI
  }
}
```

### 2.4 webpack-cli çš„å…·ä½“ä½œç”¨

```javascript
/**
 * webpack-cli æä¾›çš„åŠŸèƒ½
 */

// 1. å‘½ä»¤è¡Œå‚æ•°è§£æ
$ webpack --mode production --entry ./src/index.js --output-path ./dist

// CLI è§£æä¸º:
const config = {
  mode: 'production',
  entry: './src/index.js',
  output: {
    path: './dist'
  }
};

// 2. é…ç½®æ–‡ä»¶åŠ è½½
$ webpack --config webpack.prod.js

// CLI åŠ è½½é…ç½®æ–‡ä»¶:
const config = require('./webpack.prod.js');

// 3. å¤šé…ç½®æ”¯æŒ
$ webpack --config-name app --config-name admin

// CLI å¤„ç†å¤šé…ç½®:
webpack([appConfig, adminConfig]);

// 4. åˆå§‹åŒ–é¡¹ç›®
$ webpack init

// CLI æä¾›äº¤äº’å¼è„šæ‰‹æ¶

// 5. ä¿¡æ¯è¾“å‡º
$ webpack --json > stats.json

// CLI æ ¼å¼åŒ–è¾“å‡ºä¸º JSON

// 6. è¿›åº¦æ˜¾ç¤º
// CLI è‡ªåŠ¨æ·»åŠ  ProgressPlugin
// æ˜¾ç¤ºå½©è‰²è¿›åº¦æ¡

// 7. Watch æ¨¡å¼
$ webpack --watch

// CLI è°ƒç”¨ compiler.watch()
```

---

## ä¸‰ã€åŒ…ç®¡ç†å™¨è‡ªåŠ¨æ£€æµ‹åŸç†

### 3.1 ä¸ºä»€ä¹ˆéœ€è¦æ£€æµ‹åŒ…ç®¡ç†å™¨ï¼Ÿâ­â­â­

```javascript
/**
 * é—®é¢˜ï¼šwebpack éœ€è¦å…³å¿ƒç”¨æˆ·ä½¿ç”¨ä»€ä¹ˆåŒ…ç®¡ç†å™¨å—ï¼Ÿ
 *
 * ç­”æ¡ˆï¼šå¿…é¡»å…³å¿ƒï¼
 */

// åœºæ™¯ï¼šç”¨æˆ·é¦–æ¬¡è¿è¡Œ webpack å‘½ä»¤ï¼Œä½†æ²¡æœ‰å®‰è£… webpack-cli

// âŒ é”™è¯¯æ–¹å¼ï¼šç¡¬ç¼–ç ä½¿ç”¨ npm
$ npm install -D webpack-cli  // é—®é¢˜ï¼šç”¨æˆ·å¯èƒ½ç”¨çš„æ˜¯ yarn æˆ– pnpm

// ç»“æœé—®é¢˜ï¼š
// 1. ç”Ÿæˆå¤šä¸ª lock æ–‡ä»¶å†²çª
//    - package-lock.json (npm)
//    - yarn.lock (yarn)
//    - pnpm-lock.yaml (pnpm)
//
// 2. ä¾èµ–æ ‘ä¸ä¸€è‡´
//    - yarn/pnpm çš„ä¾èµ–è§£æç®—æ³•ä¸ npm ä¸åŒ
//    - å¯èƒ½å¯¼è‡´ç‰ˆæœ¬å†²çª
//
// 3. ç”¨æˆ·ä½“éªŒå·®
//    - ç”¨æˆ·æ˜æ˜ç”¨çš„æ˜¯ yarnï¼Œå´è¢«å¼ºåˆ¶ç”¨ npm å®‰è£…

// âœ… æ­£ç¡®æ–¹å¼ï¼šè‡ªåŠ¨æ£€æµ‹åŒ…ç®¡ç†å™¨
// æ ¹æ® lock æ–‡ä»¶åˆ¤æ–­ç”¨æˆ·ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨
// ä½¿ç”¨ç›¸åŒçš„åŒ…ç®¡ç†å™¨å®‰è£… webpack-cli
```

### 3.2 æ£€æµ‹é€»è¾‘æºç è§£æ â­â­â­

```javascript
/**
 * ä½ç½®: bin/webpack.js
 *
 * ã€æ£€æµ‹ç­–ç•¥ã€‘
 * 1. æ£€æŸ¥é¡¹ç›®æ ¹ç›®å½•çš„ lock æ–‡ä»¶
 * 2. æ ¹æ® lock æ–‡ä»¶ç±»å‹åˆ¤æ–­åŒ…ç®¡ç†å™¨
 * 3. é»˜è®¤ä½¿ç”¨ npm
 */

// ===== å®Œæ•´çš„æ£€æµ‹é€»è¾‘ =====
let packageManager;

// æ­¥éª¤1: æ£€æŸ¥ yarn.lock
if (fs.existsSync(path.resolve(process.cwd(), "yarn.lock"))) {
  packageManager = "yarn";
}
// æ­¥éª¤2: æ£€æŸ¥ pnpm-lock.yaml
else if (fs.existsSync(path.resolve(process.cwd(), "pnpm-lock.yaml"))) {
  packageManager = "pnpm";
}
// æ­¥éª¤3: é»˜è®¤ä½¿ç”¨ npm
else {
  packageManager = "npm";
}

// ===== æ„å»ºå®‰è£…å‘½ä»¤ =====
/**
 * ä¸åŒåŒ…ç®¡ç†å™¨çš„å‘½ä»¤æ ¼å¼ä¸åŒ
 */
const installOptions = [
  packageManager === "yarn" ? "add" : "install",  // yarn add vs npm install
  "-D"  // å®‰è£…åˆ° devDependencies
];

// æœ€ç»ˆå‘½ä»¤:
// yarn:  yarn add -D webpack-cli
// npm:   npm install -D webpack-cli
// pnpm:  pnpm install -D webpack-cli

// ===== æ‰§è¡Œå®‰è£… =====
runCommand(packageManager, installOptions.concat(cli.package));
/**
 * å®é™…æ‰§è¡Œçš„å‘½ä»¤å–å†³äºæ£€æµ‹ç»“æœ
 *
 * ç¤ºä¾‹1: é¡¹ç›®æœ‰ yarn.lock
 * â†’ æ‰§è¡Œ: yarn add -D webpack-cli
 * â†’ æ›´æ–°: yarn.lock
 *
 * ç¤ºä¾‹2: é¡¹ç›®æœ‰ pnpm-lock.yaml
 * â†’ æ‰§è¡Œ: pnpm install -D webpack-cli
 * â†’ æ›´æ–°: pnpm-lock.yaml
 *
 * ç¤ºä¾‹3: é¡¹ç›®æ²¡æœ‰ lock æ–‡ä»¶
 * â†’ æ‰§è¡Œ: npm install -D webpack-cli
 * â†’ ç”Ÿæˆ: package-lock.json
 */
```

### 3.3 åŒ…ç®¡ç†å™¨ç‰¹æ€§å¯¹æ¯”

```javascript
/**
 * ä¸åŒåŒ…ç®¡ç†å™¨çš„ç‰¹ç‚¹
 */

// ===== npm (Node Package Manager) =====
/**
 * ã€ç‰¹ç‚¹ã€‘
 * - Node.js å®˜æ–¹åŒ…ç®¡ç†å™¨
 * - æœ€å¹¿æ³›ä½¿ç”¨
 * - lock æ–‡ä»¶: package-lock.json
 *
 * ã€å®‰è£…å‘½ä»¤ã€‘
 * npm install package        # å®‰è£…åˆ° dependencies
 * npm install -D package     # å®‰è£…åˆ° devDependencies
 * npm install -g package     # å…¨å±€å®‰è£…
 */

// ===== yarn (Yet Another Resource Negotiator) =====
/**
 * ã€ç‰¹ç‚¹ã€‘
 * - Facebook å¼€å‘
 * - é€Ÿåº¦æ›´å¿«ï¼ˆå¹¶è¡Œä¸‹è½½ï¼‰
 * - ç¡®å®šæ€§å®‰è£…ï¼ˆyarn.lock æ›´ä¸¥æ ¼ï¼‰
 * - lock æ–‡ä»¶: yarn.lock
 *
 * ã€å®‰è£…å‘½ä»¤ã€‘
 * yarn add package           # å®‰è£…åˆ° dependencies
 * yarn add -D package        # å®‰è£…åˆ° devDependencies
 * yarn global add package    # å…¨å±€å®‰è£…
 *
 * ã€ç‰ˆæœ¬ã€‘
 * - Yarn Classic (v1): ä¼ ç»Ÿ node_modules
 * - Yarn Berry (v2+): Plug'n'Play (PnP)
 */

// ===== pnpm (Performant npm) =====
/**
 * ã€ç‰¹ç‚¹ã€‘
 * - èŠ‚çœç£ç›˜ç©ºé—´ï¼ˆç¡¬é“¾æ¥å…±äº«ï¼‰
 * - é€Ÿåº¦å¿«ï¼ˆå¢é‡å®‰è£…ï¼‰
 * - ä¸¥æ ¼çš„ä¾èµ–ç®¡ç†ï¼ˆå¹½çµä¾èµ–é—®é¢˜ï¼‰
 * - lock æ–‡ä»¶: pnpm-lock.yaml
 *
 * ã€å®‰è£…å‘½ä»¤ã€‘
 * pnpm install package       # å®‰è£…åˆ° dependencies
 * pnpm install -D package    # å®‰è£…åˆ° devDependencies
 * pnpm add -g package        # å…¨å±€å®‰è£…
 */

/**
 * webpack æ£€æµ‹è¿™äº›åŒ…ç®¡ç†å™¨çš„åŸå› ï¼š
 *
 * 1. å°Šé‡ç”¨æˆ·é€‰æ‹©
 *    - ç”¨æˆ·å¯èƒ½æœ‰ç‰¹å®šçš„åŒ…ç®¡ç†å™¨åå¥½
 *    - å›¢é˜Ÿå¯èƒ½æœ‰ç»Ÿä¸€çš„åŒ…ç®¡ç†å™¨è§„èŒƒ
 *
 * 2. é¿å… lock æ–‡ä»¶å†²çª
 *    - æ··ç”¨åŒ…ç®¡ç†å™¨ä¼šç”Ÿæˆå¤šä¸ª lock æ–‡ä»¶
 *    - å¯¼è‡´ä¾èµ–ç‰ˆæœ¬ä¸ä¸€è‡´
 *
 * 3. ä¿æŒä¾èµ–æ ‘ä¸€è‡´
 *    - ä¸åŒåŒ…ç®¡ç†å™¨çš„è§£æç®—æ³•ä¸åŒ
 *    - ä½¿ç”¨ç›¸åŒçš„åŒ…ç®¡ç†å™¨ç¡®ä¿ä¾èµ–æ ‘ä¸€è‡´
 *
 * 4. æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
 *    - è‡ªåŠ¨ä½¿ç”¨ç”¨æˆ·ä¹ æƒ¯çš„åŒ…ç®¡ç†å™¨
 *    - æ— éœ€æ‰‹åŠ¨æŒ‡å®š
 */
```

### 3.4 Yarn PnP ç‰¹æ®Šå¤„ç†

```javascript
/**
 * Yarn Plug'n'Play (PnP) æ¨¡å¼
 *
 * ã€ä»€ä¹ˆæ˜¯ PnPï¼Ÿã€‘
 * Yarn 2+ çš„ä¾èµ–ç®¡ç†æ–¹å¼ï¼Œä¸ä½¿ç”¨ node_modules
 */

// ä¼ ç»Ÿæ¨¡å¼ï¼ˆnode_modulesï¼‰
project/
â”œâ”€ node_modules/
â”‚  â”œâ”€ webpack/
â”‚  â”œâ”€ webpack-cli/
â”‚  â””â”€ ...
â””â”€ package.json

// PnP æ¨¡å¼ï¼ˆæ—  node_modulesï¼‰
project/
â”œâ”€ .yarn/
â”‚  â””â”€ cache/  â† ä¾èµ–ç¼“å­˜ï¼ˆå…¨å±€å…±äº«ï¼‰
â”œâ”€ .pnp.cjs   â† ä¾èµ–æ˜ å°„è¡¨
â””â”€ package.json

/**
 * PnP çš„ä¼˜åŠ¿ï¼š
 * - å®‰è£…é€Ÿåº¦æå¿«ï¼ˆæ— éœ€å¤åˆ¶æ–‡ä»¶ï¼‰
 * - ç£ç›˜å ç”¨æå°‘ï¼ˆå…¨å±€ç¼“å­˜ï¼‰
 * - ä¾èµ–å…³ç³»ä¸¥æ ¼ï¼ˆæ— æ³•è®¿é—®æœªå£°æ˜çš„ä¾èµ–ï¼‰
 */

// webpack çš„ PnP æ”¯æŒ
const isInstalled = packageName => {
  // â­ å¦‚æœä½¿ç”¨ PnPï¼Œç›´æ¥è®¤ä¸ºå·²å®‰è£…
  if (process.versions.pnp) {
    return true;
  }

  // å¦åˆ™ï¼Œæ£€æŸ¥ node_modules
  // ...
};

/**
 * ä¸ºä»€ä¹ˆ PnP è¿”å› trueï¼Ÿ
 *
 * 1. PnP ä¸ä½¿ç”¨ node_modulesï¼Œæ— æ³•é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥
 * 2. PnP é€šè¿‡ .pnp.cjs æ–‡ä»¶ç®¡ç†ä¾èµ–
 * 3. å¦‚æœ process.versions.pnp å­˜åœ¨ï¼Œè¯´æ˜åœ¨ PnP ç¯å¢ƒä¸­
 * 4. åœ¨ PnP ç¯å¢ƒä¸­ï¼Œrequire() ä¼šè‡ªåŠ¨è§£æä¾èµ–
 */
```

---

## å››ã€webpack çš„ä»£ç ç”Ÿæˆæœºåˆ¶

### 4.1 ä¸ºä»€ä¹ˆ webpack éœ€è¦"ä»£ç ç”Ÿæˆ"ï¼Ÿâ­â­â­

```javascript
/**
 * é—®é¢˜ï¼šwebpack ä¸éœ€è¦"æ„å»º"è‡ªå·±ï¼Œä¸ºä»€ä¹ˆæœ‰ä»£ç ç”Ÿæˆæ­¥éª¤ï¼Ÿ
 *
 * ç­”æ¡ˆï¼šwebpack æœ‰ä¸¤ç§ä»£ç ç”Ÿæˆ
 */

// ===== ç±»å‹1: è¿è¡Œæ—¶ä»£ç ç”Ÿæˆï¼ˆç»™ç”¨æˆ·çš„ bundleï¼‰â­â­â­ =====
/**
 * è¿™æ˜¯ webpack ç¼–è¯‘è¿‡ç¨‹ä¸­æœ€æ ¸å¿ƒçš„ä»£ç ç”Ÿæˆ
 *
 * ã€ç›®çš„ã€‘
 * ä¸ºç”¨æˆ·çš„åº”ç”¨ç”Ÿæˆæœ€ç»ˆçš„ bundle ä»£ç 
 */

// ç”¨æˆ·æºç :
import { add } from './math.js';
console.log(add(1, 2));

// webpack ç”Ÿæˆçš„ bundleï¼ˆç®€åŒ–ï¼‰:
(function(modules) {
  // â­ è¿™æ˜¯ webpack ç”Ÿæˆçš„è¿è¡Œæ—¶ä»£ç 
  var __webpack_require__ = function(moduleId) {
    // æ¨¡å—ç¼“å­˜
    if (cache[moduleId]) return cache[moduleId].exports;

    // æ‰§è¡Œæ¨¡å—
    var module = { exports: {} };
    modules[moduleId](module, module.exports, __webpack_require__);

    // ç¼“å­˜æ¨¡å—
    cache[moduleId] = module;
    return module.exports;
  };

  // å…¥å£æ¨¡å—
  __webpack_require__(0);
})({
  // â­ è¿™æ˜¯ç”¨æˆ·æ¨¡å—çš„è½¬æ¢ä»£ç 
  0: function(module, exports, __webpack_require__) {
    var math = __webpack_require__(1);
    console.log(math.add(1, 2));
  },
  1: function(module, exports) {
    exports.add = function(a, b) { return a + b; };
  }
});

/**
 * webpack ç”Ÿæˆäº†ä»€ä¹ˆï¼Ÿ
 *
 * 1. è¿è¡Œæ—¶ä»£ç ï¼ˆ__webpack_require__ï¼‰
 * 2. æ¨¡å—åŒ…è£…ä»£ç ï¼ˆfunction(module, exports, require) {...}ï¼‰
 * 3. æ¨¡å—æ˜ å°„å¯¹è±¡ï¼ˆ{ 0: ..., 1: ... }ï¼‰
 * 4. IIFE ç»“æ„ï¼ˆç«‹å³æ‰§è¡Œå‡½æ•°ï¼‰
 */

// ===== ç±»å‹2: webpack è‡ªèº«çš„å·¥å…·ä»£ç ç”Ÿæˆ â­ =====
/**
 * è¿™æ˜¯ä¸ºäº†ä¼˜åŒ– webpack è‡ªå·±çš„æºç 
 *
 * ã€ä½ç½®ã€‘
 * tooling/generate-runtime-code.js
 *
 * ã€ç›®çš„ã€‘
 * ä¼˜åŒ– webpack æºç ä¸­çš„è¿è¡Œæ—¶ä»£ç ç‰‡æ®µ
 */

// webpack æºç ä¸­çš„è¿è¡Œæ—¶ä»£ç ï¼ˆlib/util/semver.jsï¼‰:
//#region runtime code: parseVersion
exports.parseVersion = (str) => {
  // è¿™é‡Œæ˜¯å®Œæ•´çš„ç‰ˆæœ¬è§£æé€»è¾‘
  // åŒ…å«æ³¨é‡Šã€å®Œæ•´çš„å˜é‡å
  const parts = str.split('.');
  const major = parseInt(parts[0]);
  const minor = parseInt(parts[1]);
  return { major, minor };
};
//#endregion

// ç”Ÿæˆä¼˜åŒ–åçš„ä»£ç ï¼ˆå‹ç¼©ã€ES5 è½¬æ¢ï¼‰:
exports.parseVersionRuntimeCode = runtimeTemplate => `
var parseVersion = ${runtimeTemplate.basicFunction("str", [
  "var t=str.split('.'),n=parseInt(t[0]),r=parseInt(t[1]);return{major:n,minor:r}"
])}
`;

/**
 * ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿ
 *
 * 1. å‡å° bundle ä½“ç§¯
 *    - è¿è¡Œæ—¶ä»£ç ä¼šæ³¨å…¥åˆ°æ¯ä¸ª bundle
 *    - å‹ç¼©å¯ä»¥å‡å°å‡  KB
 *
 * 2. æ€§èƒ½ä¼˜åŒ–
 *    - å»é™¤ä¸å¿…è¦çš„ä»£ç 
 *    - ä¼˜åŒ–æ‰§è¡Œæ•ˆç‡
 *
 * 3. å…¼å®¹æ€§
 *    - è½¬æ¢ä¸º ES5
 *    - æ”¯æŒæ—§ç‰ˆæµè§ˆå™¨
 */
```

### 4.2 ä»£ç ç”Ÿæˆçš„åœºæ™¯è¯¦è§£

#### åœºæ™¯1: è¿è¡Œæ—¶ä»£ç ç”Ÿæˆï¼ˆä¸»è¦ï¼‰â­â­â­

```javascript
/**
 * webpack ç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä»£ç ç”Ÿæˆ
 *
 * ä½ç½®: lib/Compilation.js: codeGeneration()
 */

// æ­¥éª¤1: ä¸ºæ¯ä¸ªæ¨¡å—ç”Ÿæˆä»£ç 
for (const module of modules) {
  const result = module.codeGeneration({
    chunkGraph,
    moduleGraph,
    runtimeTemplate,
    runtime
  });

  // result.sources = {
  //   'javascript': ConcatSource { ... }
  // }
}

// æ­¥éª¤2: ç”Ÿæˆè¿è¡Œæ—¶ä»£ç 
for (const chunk of chunks) {
  // æ·»åŠ è¿è¡Œæ—¶æ¨¡å—
  compilation.addRuntimeModule(chunk, new LoadScriptRuntimeModule());
  compilation.addRuntimeModule(chunk, new HotModuleReplacementRuntimeModule());
}

// æ­¥éª¤3: æ¸²æŸ“ chunk ä¸ºå®Œæ•´çš„ bundle
const source = JavascriptModulesPlugin.renderMain({
  chunk,
  chunkGraph,
  runtimeTemplate,
  moduleGraph
});

/**
 * ç”Ÿæˆçš„ä»£ç åŒ…å«ï¼š
 *
 * 1. IIFE åŒ…è£…
 *    (function() { ... })();
 *
 * 2. æ¨¡å—å®šä¹‰å¯¹è±¡
 *    var __webpack_modules__ = { ... };
 *
 * 3. æ¨¡å—ç¼“å­˜
 *    var __webpack_module_cache__ = {};
 *
 * 4. require å‡½æ•°
 *    function __webpack_require__(moduleId) { ... }
 *
 * 5. è¿è¡Œæ—¶è¾…åŠ©å‡½æ•°
 *    __webpack_require__.d = defineProperty;
 *    __webpack_require__.e = ensureChunk;
 *    __webpack_require__.n = getDefaultExport;
 *
 * 6. å…¥å£è°ƒç”¨
 *    __webpack_require__(0);
 */
```

#### åœºæ™¯2: å·¥å…·ä»£ç ç”Ÿæˆï¼ˆæ¬¡è¦ï¼‰â­

```javascript
/**
 * webpack å¼€å‘è¿‡ç¨‹ä¸­çš„ä»£ç ä¼˜åŒ–
 *
 * ä½ç½®: tooling/generate-runtime-code.js
 *
 * ã€ä½¿ç”¨æ—¶æœºã€‘
 * webpack å¼€å‘è€…ä¿®æ”¹æºç åï¼Œè¿è¡Œå·¥å…·ç”Ÿæˆä¼˜åŒ–ä»£ç 
 */

// å‘½ä»¤
$ node tooling/generate-runtime-code.js --write

// å¤„ç†æµç¨‹:
// 1. æ‰«ææºç ä¸­çš„ //#region runtime code: xxx æ ‡è®°
// 2. æå–å‡½æ•°ä»£ç 
// 3. ä½¿ç”¨ terser å‹ç¼©
// 4. è½¬æ¢ä¸º ES5
// 5. å†™å›æºæ–‡ä»¶

// ç¤ºä¾‹: lib/util/semver.js

// å¼€å‘æ—¶ç¼–å†™ï¼ˆå¯è¯»æ€§å¥½ï¼‰:
//#region runtime code: parseVersion
exports.parseVersion = (str) => {
  const parts = str.split('.');
  const major = parseInt(parts[0], 10);
  const minor = parseInt(parts[1], 10);
  const patch = parseInt(parts[2], 10);
  return { major, minor, patch };
};
//#endregion

// å·¥å…·ç”Ÿæˆï¼ˆä¼˜åŒ–åï¼‰:
//#region runtime code: parseVersion
exports.parseVersionRuntimeCode = runtimeTemplate => `var parseVersion = ${
  runtimeTemplate.basicFunction("t", [
    "var n=t.split('.'),r=parseInt(n[0],10),e=parseInt(n[1],10),a=parseInt(n[2],10);",
    "return{major:r,minor:e,patch:a}"
  ])
}`;
//#endregion

/**
 * å¥½å¤„ï¼š
 *
 * 1. å¼€å‘æ—¶å¯è¯»æ€§å¥½
 *    - å®Œæ•´çš„ä»£ç ï¼Œæœ‰æ³¨é‡Š
 *    - æ˜“äºç»´æŠ¤å’Œä¿®æ”¹
 *
 * 2. è¿è¡Œæ—¶ä½“ç§¯å°
 *    - å‹ç¼©åçš„ä»£ç æ›´å°
 *    - å‡å°‘ç”¨æˆ· bundle çš„å¤§å°
 *
 * 3. å…¼å®¹æ€§å¥½
 *    - è½¬æ¢ä¸º ES5
 *    - æ”¯æŒæ—§ç‰ˆæµè§ˆå™¨
 */
```

### 4.3 ä»£ç ç”Ÿæˆæµç¨‹å›¾

```mermaid
graph TD
    Start([webpack ç¼–è¯‘å¼€å§‹]) --> Make[Make é˜¶æ®µ<br/>æ„å»ºæ¨¡å—]

    Make --> Seal[Seal é˜¶æ®µ<br/>ä¼˜åŒ–å’Œç”Ÿæˆ]

    Seal --> CodeGen[codeGeneration<br/>â­ ä»£ç ç”Ÿæˆé˜¶æ®µ]

    CodeGen --> GenModule[ä¸ºæ¯ä¸ªæ¨¡å—ç”Ÿæˆä»£ç <br/>module.codeGeneration]

    GenModule --> TransformSource[è½¬æ¢æºç <br/>åº”