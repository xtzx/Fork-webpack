# 🚀 Webpack 源码学习 - 快速开始

> 5 分钟快速了解如何开始学习 webpack 源码

## 📂 文档导航

### 我是新手，从哪里开始？

**👉 推荐阅读顺序**：

1. **00-总览与进度.md** （5 分钟）
   - 快速了解项目进度
   - 查看知识点总结

2. **01-工程化配置与学习路线.md** （20 分钟）
   - 了解 webpack 工程化配置
   - 获取完整学习路线

3. **02-核心代码注释-启动流程.md** （30 分钟）
   - 深入理解启动流程
   - 学习设计模式

4. **03-懒加载机制深度解析.md** （40 分钟）
   - 掌握性能优化技巧
   - 学习实战应用

### 我想直接看代码？

**👉 已添加详细注释的文件**：

```
📁 bin/
└── webpack.js              ⭐⭐⭐ 命令行入口（已注释 100%）

📁 lib/
├── webpack.js              ⭐⭐⭐ 核心工厂函数（已注释 100%）
└── index.js                ⭐⭐  主导出文件（已注释 60%）
```

**使用 VSCode 打开，注释非常详细！**

---

## 🎯 3 个核心流程图

### 1. 命令行启动流程

```
$ webpack
    ↓
bin/webpack.js 启动
    ↓
检查 webpack-cli？
    ├─ 有 → 直接运行
    └─ 无 → 询问安装 → 自动安装 → 运行
```

### 2. Compiler 初始化流程（9 步）

```
webpack(config)
    ↓
1️⃣ 规范化配置
2️⃣ 应用基础默认值
3️⃣ 创建 Compiler
4️⃣ 应用 Node 环境插件
5️⃣ 注册用户插件
6️⃣ 应用完整默认值
7️⃣ 触发环境钩子
8️⃣ 应用内置插件
9️⃣ 触发初始化钩子
    ↓
返回 compiler 实例
```

### 3. 懒加载机制

```
require('webpack')
    ↓
只加载 index.js（~10ms）
    ↓
访问 webpack.DefinePlugin
    ↓
触发 getter（首次）
    ↓
require('./DefinePlugin')
    ↓
缓存模块
    ↓
下次访问直接返回缓存
```

---

## 💡 5 个关键知识点

### 1. Webpack 不需要构建！

```javascript
// ❌ 错误认知
webpack 源码 → babel 转译 → 输出到 dist/

// ✅ 实际情况
webpack 源码（lib/*.js）→ 直接运行 ✨
TypeScript → 仅用于类型检查（不生成代码）
```

### 2. 懒加载带来 50 倍性能提升

```javascript
// 传统方式：启动时加载 400+ 文件，~500ms
module.exports = {
    Compiler: require('./Compiler'),
    Compilation: require('./Compilation'),
    // ... 200+ 个导出
};

// webpack 方式：启动时加载 2-3 个文件，~10ms
module.exports = {
    get Compiler() { return require('./Compiler'); },
    // getter + memoize = 懒加载 + 缓存
};
```

### 3. 两阶段配置验证

```javascript
// 阶段1：预编译 schema（快，纯 JS）
if (!webpackOptionsSchemaCheck(options)) {
    // 阶段2：完整 schema（慢，JSON Schema）
    validateSchema(webpackOptionsSchema, options);
}

// 90% 的配置通过快速检查，性能提升显著
```

### 4. 插件注册有讲究

```javascript
// ❌ 如果这样：
applyWebpackOptionsDefaults(options);  // 先应用默认值
registerUserPlugins(options.plugins);   // 再注册用户插件

// ✅ webpack 的顺序：
registerUserPlugins(options.plugins);   // 先注册用户插件
applyWebpackOptionsDefaults(options);  // 再应用默认值

// 原因：用户插件可能需要知道配置是否显式设置（undefined vs 有值）
```

### 5. 函数即对象

```javascript
const webpack = require('webpack');

// 既是函数
webpack(config);

// 又是对象
webpack.Compiler;
webpack.version;

// 实现：
const fn = () => { /* ... */ };
fn.prop = 'value';
module.exports = fn;
```

---

## 🛠️ 实战：调试 Webpack

### 步骤 1: 创建调试配置

```json
// .vscode/launch.json
{
    "version": "0.2.0",
    "configurations": [
        {
            "type": "node",
            "request": "launch",
            "name": "调试 Webpack",
            "program": "${workspaceFolder}/bin/webpack.js",
            "cwd": "${workspaceFolder}"
        }
    ]
}
```

### 步骤 2: 设置断点

推荐断点位置：
- `lib/webpack.js:134` - createCompiler 函数开始
- `lib/webpack.js:177` - WebpackOptionsApply 之前
- `lib/index.js:220` - 懒加载函数创建

### 步骤 3: 启动调试

1. 打开 VSCode
2. 按 F5 启动调试
3. 观察变量值和调用栈

---

## 📚 学习路径

### 🔰 初级（第 1 周）

**目标**：理解启动流程

- [ ] 阅读 bin/webpack.js（已注释）
- [ ] 阅读 lib/webpack.js（已注释）
- [ ] 理解 createCompiler 的 9 个步骤
- [ ] 调试运行一次 webpack

**验收**：能解释 webpack 启动时做了什么

### 🔧 中级（第 2-3 周）

**目标**：理解编译流程

- [ ] 阅读 lib/Compiler.js
- [ ] 理解钩子系统（tapable）
- [ ] 阅读 lib/Compilation.js 的 seal 阶段
- [ ] 理解模块构建流程

**验收**：能画出编译流程图

### 🚀 高级（第 4-6 周）

**目标**：掌握核心机制

- [ ] 理解模块解析（enhanced-resolve）
- [ ] 理解依赖图构建
- [ ] 理解代码生成
- [ ] 理解 HMR 原理

**验收**：能实现一个简化版 webpack

### 🎓 专家（第 7+ 周）

**目标**：深入特性

- [ ] 优化策略（SplitChunksPlugin）
- [ ] 缓存系统
- [ ] Module Federation
- [ ] 自定义插件开发

**验收**：能为 webpack 贡献代码

---

## 🎯 每日学习计划

### Day 1: 概览
- ⏰ 30 分钟
- 📖 阅读 00-总览与进度.md
- 📖 阅读 01-工程化配置与学习路线.md（前两章）

### Day 2: 启动流程
- ⏰ 1 小时
- 📖 阅读 02-核心代码注释-启动流程.md
- 💻 调试 bin/webpack.js

### Day 3: 懒加载
- ⏰ 1 小时
- 📖 阅读 03-懒加载机制深度解析.md
- 💻 查看 lib/index.js 实现

### Day 4-5: Compiler
- ⏰ 2 小时/天
- 💻 阅读 lib/Compiler.js
- ✍️ 添加自己的理解注释

### Day 6-7: Compilation
- ⏰ 2 小时/天
- 💻 阅读 lib/Compilation.js
- 📊 画出编译流程图

---

## ❓ 常见问题

### Q: 代码看不懂怎么办？

A:
1. ✅ 先看已添加注释的文件
2. ✅ 利用调试器单步跟踪
3. ✅ 阅读相关测试用例
4. ✅ 查看配套文档说明

### Q: 应该记笔记吗？

A: **强烈建议！** 笔记帮助：
- 整理思路
- 加深理解
- 方便回顾

### Q: 需要全部看完吗？

A: **不需要！** 根据目标选择：
- 🎯 理解原理：看核心流程即可
- 🎯 开发插件：重点看插件系统
- 🎯 性能优化：重点看优化相关
- 🎯 面试准备：看常见问题

### Q: 遇到问题怎么办？

A:
1. 查看文档中的"常见问题"章节
2. 在代码中搜索相关关键词
3. 阅读官方文档
4. 查看 GitHub Issues
5. 在社区提问

---

## 🎁 学习资源

### 本项目文档

```
学习文档/
├── 00-总览与进度.md           ⭐ 进度追踪
├── 01-工程化配置与学习路线.md  ⭐ 学习指南
├── 02-核心代码注释-启动流程.md ⭐ 启动详解
├── 03-懒加载机制深度解析.md   ⭐ 性能优化
└── 快速开始.md                ⭐ 本文档
```

### 已注释的源码

```
bin/webpack.js        ⭐⭐⭐ 100% 注释
lib/webpack.js        ⭐⭐⭐ 100% 注释
lib/index.js          ⭐⭐  60% 注释
```

### 官方资源

- [Webpack 官方文档](https://webpack.js.org/)
- [Webpack GitHub](https://github.com/webpack/webpack)
- [Tapable 库](https://github.com/webpack/tapable)

---

## ✨ 开始学习！

1. **今天（30 分钟）**：阅读 00-总览与进度.md
2. **明天（1 小时）**：阅读 02-核心代码注释-启动流程.md
3. **后天（1 小时）**：调试代码，设置断点观察

**记住**：
- ✅ 不要试图一次看完所有代码
- ✅ 利用已添加的详细注释
- ✅ 多动手调试，少记忆细节
- ✅ 理解设计思想比记住每行代码更重要

---

**祝学习愉快！** 🎉

有任何问题，可以在代码中查看详细注释或阅读配套文档。
